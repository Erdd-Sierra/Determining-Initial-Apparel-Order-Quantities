================================================================================
  アパレル商品発注最適化ツール (SCM Optimization Tool)
  Version 5.0
================================================================================

【概要】
本ツールは、不確実な需要のもとで、モンテカルロシミュレーションと混合整数計画法
を用いて、アパレル商品の最適な発注量を決定するためのStreamlitアプリケーションです。
香港工場と中国工場それぞれについて、最小ロット数制約を考慮した実用的な発注量を
推奨します。

【主な機能】
1. モンテカルロシミュレーションによる需要予測
2. 混合整数計画法による最適発注量の計算
3. 最小ロット数制約を考慮した推奨発注量の算出
4. 全シミュレーション結果の表形式表示
5. 詳細な統計情報と可視化
6. CSV形式での結果エクスポート

【システム要件】
- Python 3.10以上
- 必要なライブラリ:
  * streamlit
  * numpy
  * pandas
  * plotly
  * pulp
  * scipy

【インストール方法】
1. 必要なライブラリをインストール:
   pip install streamlit numpy pandas plotly pulp scipy

2. アプリケーションを起動:
   streamlit run 5th_program.py

【使い方】

1. パラメータ設定（サイドバー）
   - シミュレーション回数を設定（デフォルト: 100回、最大: 1000回）
   - 合計発注量は10,000で固定

2. 工場の選択
   - 「香港工場」タブまたは「中国工場」タブを選択
   - 各工場の最小ロット数:
     * 香港工場: 600
     * 中国工場: 1200

3. シミュレーション実行
   - 「シミュレーション実行」ボタンをクリック
   - シミュレーションが完了するまで待機

4. 結果の確認
   結果は4つのタブに分かれて表示されます:

   【サマリー】
   - 推奨方法の選択（平均値、中央値、最頻値）
   - 推奨発注量（最小ロット数調整後）
   - 最終推奨発注量（合計10,000に調整）
   - 利益統計（平均、最小、最大、標準偏差）

   【全シミュレーション結果】
   - 各シミュレーション回での発注量を表形式で表示
   - CSV形式でダウンロード可能

   【統計情報】
   - 各商品の統計量（平均、中央値、最小、最大、標準偏差）
   - 最小ロット数遵守率（各商品が最小ロット数以上で発注された割合）
   - 0発注率（発注されなかった割合）
   - 遵守率の可視化グラフ

   【可視化】
   - 発注量分布の箱ひげ図
   - 利益分布のヒストグラム
   - 発注量の比較グラフ（平均、中央値、需要）

【推奨発注量の算出方法】

本ツールでは、以下の3つの方法から推奨発注量を選択できます:

1. 平均値
   - 全シミュレーション結果の平均値
   - 従来の方法だが、最小ロット数未満になる可能性がある

2. 中央値
   - 全シミュレーション結果の中央値
   - 外れ値の影響を受けにくい
   - 最小ロット数制約を満たしやすい

3. 最頻値（四捨五入後）
   - 発注量を四捨五入した後の最頻値
   - 最も頻繁に選択された発注量
   - 実務的な推奨値として適している

選択した推奨方法で計算された発注量が最小ロット数未満の場合、
自動的に最小ロット数に調整され、その後、合計発注量が10,000になる
ように比例配分されます。

【最適化問題の定式化】

目的関数: 総利益の最大化
  max Σ[P_j × min(x_j, D_j) - C_u^j × s_j - C_o^j × e_j]

制約条件:
  1. 不足量・余剰量の定義: x_j - D_j = s_j - e_j
  2. 合計発注量: Σx_j = 10,000
  3. 最小ロット数制約（Big-M法）:
     x_j = 0 または x_j ≥ L_j
  4. 非負制約: x_j ≥ 0, s_j ≥ 0, e_j ≥ 0

ここで:
  - x_j: 商品jの発注量
  - D_j: 商品jの需要
  - P_j: 商品jの卸売価格
  - C_u^j: 機会損失単価（卸売価格の24%）
  - C_o^j: 売れ残り損失単価（卸売価格の8%）
  - s_j: 不足量
  - e_j: 余剰量
  - L_j: 最小ロット数

【商品データ】

本ツールでは、以下の10種類の商品を扱います:
  - Gail, Isis, Entice, Assault, Teri
  - Electra, Stephanie, Seduced, Anita, Daphne

各商品について、以下のパラメータが定義されています:
  - 平均需要（Mean）
  - 標準偏差（StdDev）
  - 卸売価格（Price）
  - 機会損失単価（UnderageCost）
  - 売れ残り損失単価（OverageCost）

【注意事項】

1. シミュレーション回数について
   - 回数を増やすと精度は向上しますが、計算時間も増加します
   - 推奨: 100〜500回

2. 最小ロット数制約について
   - 各工場で異なる最小ロット数が設定されています
   - 推奨発注量は自動的に最小ロット数以上に調整されます

3. 合計発注量について
   - 合計発注量は厳密に10,000に設定されています
   - 最終推奨発注量は、この制約を満たすように調整されます

4. 最適化の結果について
   - 最適化が失敗した場合（実行不可能など）、エラーメッセージが表示されます
   - その場合、シミュレーション回数を減らすか、パラメータを調整してください

【トラブルシューティング】

Q: シミュレーションが失敗する
A: シミュレーション回数を減らすか、最適化ソルバーの設定を確認してください。

Q: 推奨発注量が最小ロット数未満になる
A: 本ツールでは自動的に最小ロット数に調整されます。中央値や最頻値を
   選択することで、この問題を軽減できます。

Q: 合計発注量が10,000にならない
A: 最終推奨発注量は、合計が10,000になるように比例配分されます。
   サマリータブの「最終合計発注量」を確認してください。

【ライセンス】
本ツールは教育・研究目的で提供されています。

【更新履歴】
Version 5.0 (2025)
  - 全シミュレーション結果の表形式表示機能を追加
  - 推奨発注量の算出方法を複数選択可能に（平均値、中央値、最頻値）
  - 最小ロット数制約を考慮した自動調整機能を追加
  - 詳細な統計情報と可視化機能を強化
  - CSVエクスポート機能を追加

【連絡先】
ご質問やご要望がございましたら、開発者までご連絡ください。

================================================================================

